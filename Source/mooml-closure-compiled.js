var Mooml={version:"1.1",templates:{},engine:{callstack:[],tags:{}},htmlTags:["a","abbr","address","area","article","aside","audio","b","base","bdo","blockquote","body","br","button","canvas","caption","cite","col","colgroup","command","datalist","dd","del","details","dialog","dfn","div","dl","dt","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","keygen","kbd","label","legend","li","link","map","mark",
"menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","samp","script","section","select","small","source","span","strong","style","sub","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","ul","var","video","acronym","applet","basefont","big","center","dir","font","frame","frameset","noframes","s","strike","tt","u","xmp"],evaluate:function(a,c){var b=[];this.engine.callstack.push(a);$splat(c||
{}).each(function(d,e){a.code(d,e);b.extend(a.nodes.filter(function(f){return f.getParent()===null}));a.nodes.empty()});this.engine.callstack.pop();this.engine.callstack.length&&a.saveElementRefs&&$extend(this.engine.callstack.getLast().elementRefs,a.elementRefs);return b.length>1?b:b.shift()},initEngine:function(){this.htmlTags.each(function(a){Mooml.engine.tags[a]=function(){var c=Mooml.engine.callstack.getLast(),b=new Element(a);$each(arguments,function(d,e){if($type(d)==="function")d=d();switch($type(d)){case "array":case "element":case "collection":b.adopt(d);
break;case "string":c&&b.getChildren().each(function(f){c.nodes.erase(f)});b.set("html",b.get("html")+d);break;case "number":b.appendText(d.toString());break;case "object":if(e===0){if(c&&c.saveElementRefs&&d.id)c.elementRefs[d.id]=b;b.set(d)}break}});c&&c.nodes.push(b);return b}})},prepare:function(a){var c=a.toString();a=c.match(/\(([a-zA-Z0-9,\s]*)\)/)[1].replace(/\s/g,"").split(",");c=c.match(/\{([\s\S]*)\}/m)[1];return new Function(a,"with (Mooml.engine.tags) {"+c+"}")}};
Mooml.Template=new Class({nodes:[],initialize:function(a,c,b){this.saveElementRefs=b&&b.saveElementRefs===true?true:false;this.elementRefs=b&&b.elementRefs&&typeof b.elementRefs==="object"?b.elementRefs:{};this.name=a;this.code=Mooml.prepare(c)},render:function(a){return Mooml.evaluate(this,a)}});Mooml.Templates={templates:{},register:function(a,c,b){this.templates[a]=new Mooml.Template(a,c,b)},render:function(a,c){return(a=this.templates[a])?a.render(c):null}};$extend(Mooml,Mooml.Templates);Mooml.initEngine();